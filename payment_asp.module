<?php

use Drupal\Core\Form\FormStateInterface;
use Symfony\Component\HttpFoundation\Request;
use Drupal\payment_asp\Controller\PaymentASPController;
use Drupal\commerce_payment\PaymentOption;

/**
* Implements hook_form_alter(&$form, FormStateInterface $form_state, $form_id).
*/
function payment_asp_form_alter(&$form, FormStateInterface $form_state, $form_id) {

	// Commerce Checkout step "Order Information"
	if($form_id == 'commerce_checkout_flow_multistep_default' && $form['#step_id'] == 'order_information') {
		
		$payment_methods = \Drupal\commerce_payment\Entity\PaymentMethod::loadMultiple();
		if(isset($payment_methods)) {
			foreach ($payment_methods as $key => $value) {
				$value->delete();
			}
		}
		// ksm($form_state->getValue('payment_information')['payment_method']);

		// Add Split Count select input on Credit Card Selection
		ksm($form);
		if($form_state->getValue('payment_information')['payment_method'] == 'credit_card_3d') {
			$form['payment_information']['payment_method']['offsite-payment']['payment_installment'] = [
		      '#title' => t('Split Count'),
		      '#type' => 'select',
		      '#required' => TRUE,
		      '#default_value' => 'One-time payment', 
		      '#options' => array(
		      	'One-time payment' => 'One-time payment',
		      	'2' => '2',
		      	'3' => '3',
		      	'5' => '5',
		      	'6' => '6',
		      ),
			];
		} else {
			// unset($form['payment_information']['payment_method']['add_payment_method']['payment_installment']);
		}


	}

	// Commerce Checkout step "Review"
	if($form_id == 'commerce_checkout_flow_multistep_default' && $form['#step_id'] == 'review') {
		// unset($form['actions']['next']['#submit']);
		// unset($form['#submit']);
		// $form['actions']['next']['#submit'][] = 'payment_asp_form_submit';
	}

	// Refund
	if($form_id == 'commerce_payment_payment_manual_operation_form') {
		// ksm($form);
		// $form['actions']['submit']['#submit'][] = 'payment_asp_form_submit';
	}


	// $query = \Drupal::database()
	// 					->select('commerce_payment')
	// 					->fields('commerce_payment', array('payment_id'))
	// 					->condition('payment_id', 1)
	// 					->execute();

	// $query2 = \Drupal::database();
	// $xx = [];
	// foreach ($query as $key => $value) {
	// 	array_push($xx, $key);
	// }
}


function payment_asp_form_submit(array $form, FormStateInterface $form_state) {
	drupal_set_message('mao ray nahitabo', 'error');
}